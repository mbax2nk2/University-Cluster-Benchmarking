#!/usr/bin/env Rscript
args = commandArgs(trailingOnly=TRUE)
library('reshape')
library('plyr')
library('scales')
library('ggplot2')

nba <- read.csv(paste(args[1],args[2], sep=""), sep=",")
nba$check<-as.integer(rank(-nba$check))
nba$compiler.compiler<-as.integer(rank(-nba$compiler.compiler))
nba$compiler.sunflow<-as.integer(rank(-nba$compiler.sunflow))
nba$compress<-as.integer(rank(-nba$compress))
nba$crypto.aes<-as.integer(rank(-nba$crypto.aes))
nba$crypto.rsa<-as.integer(rank(-nba$crypto.rsa))
nba$crypto.signverify<-as.integer(rank(-nba$crypto.signverify))
nba$derby<-as.integer(rank(-nba$derby))
nba$mpegaudio<-as.integer(rank(-nba$mpegaudio))
nba$scimark.fft.large<-as.integer(rank(-nba$scimark.fft.large))
nba$scimark.fft.small<-as.integer(rank(-nba$scimark.fft.small))
nba$scimark.lu.large<-as.integer(rank(-nba$scimark.lu.large))
nba$scimark.lu.small<-as.integer(rank(-nba$scimark.lu.small))
nba$scimark.monte_carlo<-as.integer(rank(-nba$scimark.monte_carlo))
nba$scimark.sor.large<-as.integer(rank(-nba$scimark.sor.large))
nba$scimark.sor.small<-as.integer(rank(-nba$scimark.sor.small))
nba$scimark.sparse.large<-as.integer(rank(-nba$scimark.sparse.large))
nba$scimark.sparse.small<-as.integer(rank(-nba$scimark.sparse.small))
nba$serial<-as.integer(rank(-nba$serial))
nba$starrtup.crypto.signverify<-as.integer(rank(-nba$starrtup.crypto.signverify))
nba$startup.compiler.compiler<-as.integer(rank(-nba$startup.compiler.compiler))
nba$startup.compiler.sunflow<-as.integer(rank(-nba$startup.compiler.sunflow))
nba$startup.compress<-as.integer(rank(-nba$startup.compress))
nba$startup.crypto.aes<-as.integer(rank(-nba$startup.crypto.aes))
nba$startup.crypto.rsa<-as.integer(rank(-nba$startup.crypto.rsa))
nba$startup.helloworld<-as.integer(rank(-nba$startup.helloworld))
nba$startup.mpegaudio<-as.integer(rank(-nba$startup.mpegaudio))
nba$startup.scimark.fft<-as.integer(rank(-nba$startup.scimark.fft))
nba$startup.scimark.lu<-as.integer(rank(-nba$startup.scimark.lu))
nba$startup.scimark.monte_carlo<-as.integer(rank(-nba$startup.scimark.monte_carlo))
nba$startup.scimark.sor<-as.integer(rank(-nba$startup.scimark.sor))
nba$startup.scimark.sparse<-as.integer(rank(-nba$startup.scimark.sparse))
nba$startup.serial<-as.integer(rank(-nba$startup.serial))
nba$startup.sunflow<-as.integer(rank(-nba$startup.sunflow))
nba$startup.xml.transform<-as.integer(rank(-nba$startup.xml.transform))
nba$startup.xml.validation<-as.integer(rank(-nba$startup.xml.validation))
nba$sunflow<-as.integer(rank(-nba$sunflow))
nba$xml.transform<-as.integer(rank(-nba$xml.transform))
nba$xml.validation<-as.integer(rank(-nba$xml.validation))
nba$name <- factor(nba$name, levels = rev(levels(nba$name)))
row.names(nba) <- nba$name
nba.m <- melt(nba)
nba.m <- ddply(nba.m, .(variable), transform,
  rescale = rescale(value,to=c(1,31)))
p<-((ggplot(nba.m, aes(variable, name))
     + geom_tile(aes(fill = rescale),colour = "white")
     + scale_fill_gradient(low = "steelblue",high = "white"))
     + xlab("Benchmark names")
     + ylab("Cluster names")
     + theme(axis.text.x = element_text(angle=90,vjust=0.5)))
write.csv(nba, file = paste(args[1],args[4],"ranking.csv", sep=""))
ggsave(paste(args[1],args[3],sep=""),p)
